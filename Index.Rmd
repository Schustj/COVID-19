---
title: "Index.Rmd"
output: html_document
---

```{r setup, include=FALSE, echo = FALSE}
library(tidyverse)
library(stringr)
library(choroplethr)
library(choroplethrMaps)
library(ggplot2)
library(dplyr)
library(knitr)
library(kableExtra)
knitr::opts_chunk$set(echo = TRUE)
```

 <!-- This chunk is uploading all the databases to my Rmd file. Files from the CDC.   --> 

```{r importing, message = FALSE, echo = FALSE}
data(state.regions)
myData <- read_csv("raw_data/US_MAP_DATA.csv", skip = 2)
myData2 <- read_csv("raw_data/Provisional_COVID-19_Death_Counts_by_Place_of_Death_and_State.csv")

```

 <!-- Manipulating data from myData2 from the CDC to show total deaths due to COVID in Midwest Coalition States --> 

```{r data2stuff, message=FALSE, echo=FALSE, warning=FALSE}

covid19Data <- myData2 %>% select(`State`, `COVID19 Deaths`) %>% rename(Deaths = `COVID19 Deaths`) %>% group_by(State) %>% filter(State %in% c("Michigan", "Ohio", "Wisconsin", "Minnesota", "Illinois", "Indiana", "Kentucky") & !is.na(`Deaths`))

write.csv(deathData,"C:/Users/Jonny/Documents/GitHub/COVID-19/output/Dth_by_state_midwest_coalition_data2.csv", row.names = FALSE)
```

 <!-- Preparing to create a bar plot of death data due to COVID for Midwest Coalition States. --> 

```{r ggplotcovid, message=FALSE, echo=FALSE, warning=FALSE}

ggplot(covid19Data, aes(State, Deaths)) + geom_bar() + labs(title = "Midwest Coalition States COVID deaths", x = "State", y = "Deaths")

```

 <!-- Manipulating data from myData2 from the CDC to show total deaths due to COVID in similar population States --> 

```{r data2stuff2, message=FALSE, echo=FALSE, warning=FALSE}

covid19Data2 <- myData2 %>% select(`State`, `COVID19 Deaths`) %>% rename(Deaths = `COVID19 Deaths`) %>% filter(State %in% c("New Jersey", "Georgia", "Maryland", "Colorado", "Pennsylvania", "Tennessee", "Louisiana") & !is.na(`Deaths`))

write.csv(deathData,"C:/Users/Jonny/Documents/GitHub/COVID-19/output/Dth_by_state_similar_pop_data2.csv", row.names = FALSE)
```

<!-- Preparing to create a bar plot of death data due to COVID for Similar Population States. --> 

```{r ggplotcovid2, message=FALSE, echo=FALSE, warning=FALSE}

ggplot(covid19Data2, aes(State, Deaths)) + geom_bar() + labs(title = "Midwest Coalition States COVID deaths", x = "State", y = "Deaths")

```

 <!-- In this chunk I am manipulating a data set into Midwest Coalition states and making a choropleth representation. --> 

```{r tidyup, message=FALSE, echo=FALSE, warning=FALSE}

deathData <- myData %>% 
        rename(Deaths = "Total Death") %>%
        filter(fips < 57, abbr != "US" & jurisdiction %in% c("Michigan", "Ohio", "Wisconsin", "Minnesota", "Illinois", "Indiana", "Kentucky") & !is.na(fips)) %>%
        summarise(region = str_to_lower(jurisdiction), value = Deaths)

write.csv(deathData,"C:/Users/Jonny/Documents/GitHub/COVID-19/output/deaths_by_state_midwest_coalition.csv", row.names = FALSE)

```

 <!-- In this chunk I'm taking my manipulated data and making my choropleth map for Midwest coalition states. --> 

```{r choropleth, message=FALSE, echo=FALSE, warning=FALSE, fig.align='center', fig.cap="**Choropleth 1:** Total Deaths from States in the Midwest Coalition"}

state_choropleth(deathData, title = "Total Deaths", legend = "Deaths")

```

 <!-- In this chunk I'm attempting to summarize the data to get an idea about the mean deaths for the Midwest coalition states. --> 

```{r summary, message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}

summaryData <- myData %>% filter(jurisdiction %in% c("Michigan", "Ohio", "Wisconsin", "Minnesota", "Illinois", "Indiana", "Kentucky")) %>% summary('Total Death') 
print(summaryData)

```

 <!-- In this chunk I am manipulating a data set into comparison states and making a choropleth representation. --> 

```{r tidyup2, message=FALSE, echo=FALSE, warning=FALSE}

deathData2 <- myData %>% 
        rename(Deaths = "Total Death") %>%
        filter(fips < 57, abbr != "US" & jurisdiction %in% c("New Jersey", "Georgia", "Maryland", "Colorado", "Pennsylvania", "Tennessee", "Louisiana")) %>%
        summarise(region = str_to_lower(jurisdiction), value = Deaths)

write.csv(deathData,"C:/Users/Jonny/Documents/GitHub/COVID-19/output/deaths_by_state_similar_pop.csv", row.names = FALSE)

```

 <!-- In this chunk I'm taking my manipulated data and making my choropleth map for my selected comparison states. --> 

```{r choropleth2, message=FALSE, echo=FALSE, warning=FALSE, fig.align='center', fig.cap="**Choropleth 2:** Total Deaths from Comparison States"}

state_choropleth(deathData2, title = "Total Deaths", legend = "Deaths")

```

 <!-- In this chunk I'm attempting to summarize the data to get an idea about the mean deaths for the states I've selected to pair against the Midwest coalition states. --> 

```{r summary2, message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}

summaryData2 <- myData %>% rename(Deaths = "Total Death") %>% filter(jurisdiction %in% c("New Jersey", "Georgia", "Maryland", "Colorado", "Pennsylvania", "Tennessee", "Louisiana")) %>% summary("Deaths")
print(summaryData2)

```








